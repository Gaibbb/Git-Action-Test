---
title: 搭建一个邮箱服务器（1）！
tags: []
id: '215'
categories:
  - - uncategorized
---

寒假闲来无事，突然想到自己有个域名有个服务器，为何不搭建一个属于自己的邮箱服务器，在给别人发送邮件的时候用上自己的域名后缀也是逼格满满！其实在这次成功搭建之前我也有过一次搭建的经验，只不过很可惜它失败了，前面的文章也有提到过还把我的TS服务器搞坏了（域名解析方面不过关TAT），但是没有关系，这次终于是一步一步的搞定了这个难搞的邮箱，下面就来记录一下整个搭建流程与我遇到的问题。

首先说明，本文大部分基础都建立在下面这个大佬的文章上：

[Build Your Own Email Server on Ubuntu: Basic Postfix Setup - LinuxBabe](https://www.linuxbabe.com/mail-server/setup-basic-postfix-mail-sever-ubuntu)

就是说最主要的操作流程都是借鉴这篇文章的，我会在一些步骤上面结合自己当时遇到的情况进行一些说明，同时也会对一些操作进行说明。最主要还是记录这次流程让自己对搭建的方法加深记忆，如果嫌太麻烦的可以跟着原文章进行搭建。

跟原文章一样，由于这个搭建的流程实在太过于冗长，我也会分成好几篇文章进行。

* * *

本文的操作设备为腾讯云香港轻量级服务器2G2H，操作系统为Ubuntu Server 20.04 LTS 64bit，已经搭建有MYSQL、PHP、APACHE2环境，并且运行有你现在看这篇文章的博客网站。

这里我们先介绍一下Postfix，这是一个免费的Linux服务，为了替代Linux上原有的Sendmail服务，不仅性能上爆杀Sendmail，而且还能搭配其他的服务减轻邮件系统管理的难度。同时它也能兼容Sendmail，也就是说如果你想将Sendmail替换为Postfix，它能够继续使用你已有的脚本和程序。

然后是安装Postfix的前置工作，先确定一个正确的主机名，像是：

```
mail.kirisamekano.com
```

参考文章中出现了FQDN（Fully Qualified Domain Name）全限定域名，它同时包含有主机名与域名。打个比方，如果我的主机名是ame，域名是kirisamekano.com，那么我的FQDN就是ame.kirisamekano.com。

```
#输入下面的指令可以看你主机的FQDN：
ame@ame:~$ hostname -f
ame.kirisamekano.com

#输入下面的指令可以修改你主机的FQDN：
ame@ame:~$ hostnamectl set-hostname 你的FQDN
```

接下来就是给域名一个MX记录了，MX记录是别人给你发邮件的时候能找到你这个地址的前提条件。当别人给你这个地址发送邮件时，电子邮件系统会根据你地址的后缀（也就是@后面的那串东西）进行DNS的解析，只有在DNS中添加了MX解析记录，邮件才会发送到与MX记录相关的服务器上面。

由于我只有腾讯云的服务器，就用DNSPOD来做演示：

![](https://www.kirisamekano.com/wp-content/uploads/2023/02/image-1024x47.png)

DNSPOD MX记录解析

除此之外，还要添加一个指向自己IPv4地址的A解析：

![](https://www.kirisamekano.com/wp-content/uploads/2023/02/image-1-1024x46.png)

DNSPOD A记录解析

在参考文章中还提到了IPv6与PTR解析，但是我这个服务器IPv4 only，就不打算搞这个IPv6了。还有就是PTR反向解析的问题，腾讯云的轻量级应用服务器貌似是不提供反向解析服务的，而且就算是普通云服务器，那个反向解析的费用我也还是负担不起，所以这一步也免去了。但是我要在这里说明一下PTR解析对于邮箱服务器的重要性，收发过邮件的都知道，邮箱是有垃圾邮件这个东西的。有些大型的邮件服务提供商像是Gmail这种，他们的邮件过滤系统非常严格，我的邮箱就是因为一直没有搞PTR反向解析，发送到Gmail的邮件一直被丢进Spam（垃圾箱）里，后面我们也会讲到更多如何提高邮箱域名信誉的方法。所以有条件的可以去搞一个PTR反向解析服务，特别是想要长期将这个邮箱域名作为自己工作的朋友。

补充一下关于腾讯云轻量级应用服务器的PTR反向解析服务，可能还是可以搞，看看到时候我能不能搞出来，可以的话再补充关于这一段的内容。

接下来就顺便解释一下反向解析和PTR记录的概念吧。

反向解析指从IP地址到域名的映射，和正向解析是刚好反过来的，非常好理解。

PTR记录是用于IP地址在反向解析的过程中，因为一个IP地址可能被多个域名所使用，进行反向解析之前要先验证这个IP地址是否被多个域名所使用，因此要遍历DNS服务器进行验证。为了避免遍历整个DNS服务器消耗过量资源，PTR记录会将IP地址指向域名，减少资源的消耗。

下一步是安装Postfix服务，非常的简单：

```
apt install postfix
```

![](https://www.kirisamekano.com/wp-content/uploads/2023/02/LWOZFEWWX3P0R51GR_PV.png)

Postfix安装步骤1

这里我将参考文章中提供的每个选项都翻译一遍：

> [Build Your Own Email Server on Ubuntu: Basic Postfix Setup - LinuxBabe](https://www.linuxbabe.com/mail-server/setup-basic-postfix-mail-sever-ubuntu)
> 
> No configuration：意味着安装程序不会配置任何文件  
> Internet Site：意味着用Postfix来发送电子邮件到其他的MTA服务器，同时也接受来自其他MTA服务器的邮件  
> Internet with smarthost：意味着用Postfix来接受来自其他MTA服务器的邮件，但是会使用智能host来转发邮件到收件人那里  
> Satellite System：意味着使用智能host发送与接收邮件  
> Local only：意味着邮件系统只对本地用户有用（邮件只能在本地用户中收发）

这里我们使用Internet Site作为默认配置，进行下一步流程。